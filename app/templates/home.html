{% extends "base.html" %}

{% block content %}
<section class="mb-5">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-3">
    <div>
      <p class="text-uppercase text-muted small mb-1">Community Potluck</p>
      <h1 class="fw-bold">Who's bringing what?</h1>
      <p class="text-secondary">
        Track dishes, highlight allergens, and make sure every guest has something delicious.
      </p>
    </div>
    <div class="d-flex flex-column align-items-stretch gap-2">
      <a class="btn btn-lg btn-primary" href="{{ url_for('add_form') }}">Share Your Dish</a>
      <div class="btn-group" role="group" aria-label="View toggle">
        <a
          class="btn btn-outline-secondary {% if view_mode == 'cards' %}active{% endif %}"
          href="{{ url_for('home') }}?view=cards{% if search_query %}&search={{ search_query | urlencode }}{% endif %}"
        >
          Card view
        </a>
        <a
          class="btn btn-outline-secondary {% if view_mode == 'table' %}active{% endif %}"
          href="{{ url_for('home') }}?view=table{% if search_query %}&search={{ search_query | urlencode }}{% endif %}"
        >
          Table view
        </a>
      </div>
    </div>
  </div>
</section>

{% if dishes %}
  <form method="get" action="{{ url_for('home') }}" class="mb-4">
    <input type="hidden" name="view" value="{{ view_mode }}" />
    <label class="form-label fw-semibold" for="dish-search">
      Search the {{ 'table' if view_mode == 'table' else 'cards' }}
    </label>
    <div class="position-relative">
      <input
        type="search"
        class="form-control form-control-lg"
        id="dish-search"
        name="search"
        placeholder="Start typing to filter dishes..."
        value="{{ search_query }}"
        autocomplete="off"
        hx-get="{% if view_mode == 'table' %}{{ url_for('table_rows_partial') }}{% else %}{{ url_for('card_grid_partial') }}{% endif %}"
        hx-trigger="keyup changed delay:500ms, search"
        hx-target="{% if view_mode == 'table' %}#dish-table-body{% else %}#dish-card-grid{% endif %}"
        hx-indicator="#dish-search-indicator"
      />
      <div
        id="dish-search-indicator"
        class="position-absolute top-50 end-0 translate-middle-y pe-3 htmx-indicator"
      >
        <div class="spinner-border spinner-border-sm text-secondary" role="status">
          <span class="visually-hidden">Searching...</span>
        </div>
      </div>
    </div>
    <div class="form-text">Matches dish names, contributors, types, notes, and dietary info.</div>
  </form>
  {% if view_mode == 'table' %}
    <div class="table-responsive bg-white rounded-4 shadow-sm">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Dish</th>
            <th>Type</th>
            <th>Contributor</th>
            <th>Allergens</th>
            <th>Dietary</th>
            <th>Notes</th>
            <th>Added</th>
          </tr>
        </thead>
        <tbody id="dish-table-body">
          {% include "partials/table_rows.html" %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div id="dish-card-grid" class="row row-cols-1 row-cols-md-2 g-4">
      {% include "partials/card_grid.html" %}
    </div>
  {% endif %}
{% else %}
  <div class="splash-card text-center p-5 bg-white rounded-4 shadow-sm">
    <p class="text-uppercase small text-muted">The table is bare</p>
    <h2 class="fw-bold">This potluck is a blank canvas</h2>
    <p class="text-secondary mb-4">
      No dishes have landed yetâ€”plant the first culinary flag and inspire everyone else.
    </p>
    <a class="btn btn-lg btn-success" href="{{ url_for('add_form') }}">Add the very first dish</a>
  </div>
{% endif %}
{% endblock %}
